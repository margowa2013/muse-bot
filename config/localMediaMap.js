const path = require('path');

// Root folder where local media is stored
const MEDIA_ROOT = path.join(__dirname, '..', 'src');

function normalizeTitle(str) {
    if (!str) return '';
    return str
        .toLowerCase()
        // Ð·Ð°Ð¼Ñ–Ð½Ð° Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ñ‚Ð¸Ñ€Ðµ/Ð°Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ñ„Ñ–Ð²/ÐºÐ°Ð²Ñ‹Ñ‡ÐµÐº/ÐºÑ€Ð°Ð¿Ð¾Ðº Ð½Ð° Ð¿Ñ€Ð¾Ð±Ñ–Ð»
        .replace(/[_â€“â€”\-â€™'`"Â«Â».,;:!?()[\]{}]/g, ' ')
        // Ð¿Ñ€Ð¸Ð±Ð¸Ñ€Ð°Ñ”Ð¼Ð¾ Ð¿Ð¾Ð´Ð²Ð¾Ñ”Ð½Ñ– Ð¿Ñ€Ð¾Ð±Ñ–Ð»Ð¸
        .replace(/\s+/g, ' ')
        .trim();
}

// Map item titles to local file names.
// Duplicate keys without emojis ensure backward compatibility with older titles.
const LOCAL_MEDIA = {
    // Food
    'Ð¡Ð¸Ñ€Ð½Ð¸ÐºÐ¸, Ð¾Ð±Ñ–Ð¹Ð¼Ð¸ Ñ– ÐºÐ°Ð²Ð°': 'sirniki.jpg',
    'Ð¯Ð¸Ñ‡Ð½Ð¸Ñ†Ð° Ñ Ð»Ð°Ð²Ð°ÑˆÐ¸ÐºÐ¾Ð¼': 'yaichnica.jpg',
    'Ð¥Ð¾Ñ‡Ñƒ Ñ‚Ð²Ñ–Ð¹ Ð¾Ð¼Ð»ÐµÑ‚ Ñ– Ñ‚Ð²Ð¾ÑŽ ÑƒÑÐ¼Ñ–ÑˆÐºÑƒ': 'yromlet.jpg',
    'ÐœÐ¾Ð¶ÐµÑ‚ Ð½Ð°ÐºÐ¾Ð½ÐµÑ†-Ñ‚Ð¾ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ ÑÑƒÐ¿ÐµÑ€ Ð¾Ð²ÑÑÐ½ÐºÑƒ': 'ovsyanka.jpg',
    'Ð‘Ð¾Ð³Ð°Ñ‚ÐµÐ½ÑŒÐºÐ¸Ð¹ Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº': 'major.jpg',
    'Ð”Ð¾Ð±Ð°Ð²Ð¸Ð¼ Ð¿Ð¾Ð±Ð¾Ð»ÑŒÑˆÐµ Ð±ÐµÐ»ÐºÐ° Ð² Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº': 'photo_2025-12-11_11-25-30.jpg',
    'Ð¡Ð½Ñ–Ð´Ð°Ð½Ð¾Ðº Ð· Ð±ÐµÐºÐ¾Ð½Ð¾Ð¼': 'photo_2025-12-11_11-25-36.jpg',
    'ÐžÑ‚ Ð±Ð¸ Ñ‚Ð²Ð¾ÑŽ Ð³Ñ€Ð°Ð½Ð¾Ð»Ñƒ Ð· Ð¹Ð¾Ð³ÑƒÑ€Ñ‚Ð¾Ð¼ Ñ– ÑÐ¿Ð¾ÐºÐ¾Ñ”Ð¼': 'photo_2025-12-11_11-26-02.jpg',
    'Ð‘Ð»Ð¸Ð½Ñ‡Ð¸Ðº â€” Ñ– Ñ‚ÐµÐ±Ðµ Ð² Ð½ÑŒÐ¾Ð³Ð¾ Ð·Ð°Ð³Ð¾Ñ€Ð½ÑƒÑ‚Ð¸': 'photo_2025-12-11_11-26-27.jpg',
    'Ð‘Ð»Ð¸Ð½Ñ‡Ð¸Ðº Ñ– Ñ‚ÐµÐ±Ðµ Ð² Ð½ÑŒÐ¾Ð³Ð¾ Ð·Ð°Ð³Ð¾Ñ€Ð½ÑƒÑ‚Ð¸': 'photo_2025-12-11_11-26-27.jpg', // Ð±ÐµÐ· Ñ‚Ð¸Ñ€Ðµ
    'ÐŸÑŽÑ€Ðµ Ð· ÐºÑƒÑ€Ð¾Ñ‡ÐºÐ¾ÑŽ': 'photo_2025-12-11_11-26-38.jpg',
    'ÐšÑƒÑ€Ð¾Ñ‡ÐºÐ°, Ð¾Ð²Ð¾Ñ‡Ñ– Ð¹ Ñ‚Ñ€Ð¾Ñ…Ð¸ Ð»ÑŽÐ±Ð¾Ð²Ñ–': 'photo_2025-12-11_11-27-02.jpg',
    'Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ð² Ð¼ÐµÐ½ÑŽ ÐºÑ€Ð°ÑÐ½Ð°Ñ Ñ€Ñ‹Ð±ÐºÐ°': 'kras.jpg',
    'Ð“Ñ€ÐµÑ‡ÐºÐ° Ð¹ ÐºÑƒÑ€Ð¾Ñ‡ÐºÐ°': 'gre.jpg',
    'ÐŸÐ°ÑÑ‚Ñƒ â€” Ð· Ð»ÑŽÐ±Ð¾Ð²\'ÑŽ, ÑÐº Ð·Ð°Ð²Ð¶Ð´Ð¸': 'pasta.jpg',
    'ÐŸÐ°ÑÑ‚Ñƒ Ð· Ð»ÑŽÐ±Ð¾Ð²\'ÑŽ, ÑÐº Ð·Ð°Ð²Ð¶Ð´Ð¸': 'pasta.jpg', // Ð±ÐµÐ· Ñ‚Ð¸Ñ€Ðµ
    'Ð›Ð¾Ð¶ÐºÑƒ Ñ€Ð¸ÑÐ°â€¦ Ð¸Ð»Ð¸ Ð´Ð²Ðµ': 'risss.jpg',
    'ÐžÑ‡ÐµÐ½ÑŒ Ð·Ð°Ñ…Ð¾Ñ‚ÐµÐ»Ð¾ÑÑŒ Ð³Ð¾Ñ€ÑÑ‡Ð¸Ñ… Ð±ÑƒÑ‚ÐµÑ€Ð±Ñ€Ð¾Ð´Ð¾Ð²': 'hotbut.jpg',
    'Ð Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°ÐºÐ°Ð¶ÐµÐ¼ ÑÑƒÑˆÐ¸??': 'sush.jpg',
    'Ð’Ñ€ÐµÐ¼Ñ Ð¿Ð¾Ð±ÐµÐ¶Ð´Ð°Ñ‚ÑŒ ÐºÑƒÐºÑƒÑ€ÑƒÐ·Ñƒ!': 'kuku.jpg',
    'ÐŸÐ¾Ñ€Ñ†Ð¸ÑŽ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð¾Ð², Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°': 'vita.jpg',
    'Ð’Ð¾Ñ‚ Ð±Ñ‹ Ð¼Ð°Ð¼Ð° Ñ‚Ð¾Ñ€Ñ‚ ÑÐ´ÐµÐ»Ð°Ð»Ð°': 'photo_2025-12-11_11-29-26.jpg',

    // Dates (with and without emojis for compatibility)
    'ÐšÐ¸Ð½Ð¾Ñ‚ÐµÐ°Ñ‚Ñ€, Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ€ÑÐ´ ðŸ˜': 'kino.gif',
    'ÐšÐ¸Ð½Ð¾Ñ‚ÐµÐ°Ñ‚Ñ€, Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ€ÑÐ´': 'kino.gif',
    'ÐŸÐ¾ÐµÑ…Ð°Ð»Ð¸ Ð² ÑÐ°ÑƒÐ½Ñƒ ðŸ§–â€â™€ï¸': 'sauna.gif',
    'ÐŸÐ¾ÐµÑ…Ð°Ð»Ð¸ Ð² ÑÐ°ÑƒÐ½Ñƒ': 'sauna.gif',
    'Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ¶ÐºÐ° ðŸŒ²': 'probezhka.jpg',
    'Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ¶ÐºÐ°': 'probezhka.jpg',
    'Ð£Ð´Ð¸Ð²Ð¸ Ð¼ÐµÐ½Ñ!': 'udivi.gif',
    'Ð Ð°Ð½Ð´Ð¾Ð¼Ð½Ð¾Ðµ Ð´Ð»Ñ Ð½Ð°Ñ Ð´Ð²Ð¾Ð¸Ñ…': 'roulette-game.gif',

    // Long-distance
    'Ð Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð²Ð¾Ð½Ð¾Ðº Ð² Facetime ðŸ¤³ðŸ¼': 'facetime.jpg',
    'Ð Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð²Ð¾Ð½Ð¾Ðº Ð² Facetime': 'facetime.jpg',
    'Ð’Ð¾Ñ‚ Ð±Ñ‹ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÑŽ Ð¼Ð¾ÐµÐ¹ Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ¸ ðŸ‘¸ðŸ½': '181818.jpg',
    'Ð’Ð¾Ñ‚ Ð±Ñ‹ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÑŽ Ð¼Ð¾ÐµÐ¹ Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ¸': '181818.jpg',

    // Pleasures
    'ÐŸÐ¾Ñ‡ÑƒÑ…Ð°Ñ‚Ð¸ Ð³Ð¾Ð»Ð¾Ð²Ñƒ ðŸ’†ðŸ½â€': 'chux.gif',
    'ÐŸÐ¾Ñ‡ÑƒÑ…Ð°Ñ‚Ð¸ Ð³Ð¾Ð»Ð¾Ð²Ñƒ': 'chux.gif',
    'ÐœÐ°ÑÑÐ°Ð¶ ðŸ˜': 'massage.gif',
    'ÐœÐ°ÑÑÐ°Ð¶': 'massage.gif',
    'Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ Ð² Call of Duty Ð²ÐµÑÑŒ Ð²ÐµÑ‡ÐµÑ€ ðŸŽ®': 'cod.mp4',
    'Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ Ð² Call of Duty Ð²ÐµÑÑŒ Ð²ÐµÑ‡ÐµÑ€': 'cod.mp4',
};

function getLocalMediaPath(title) {
    if (!title) return null;

    // 1) Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ð·Ð±Ñ–Ð³
    const exact = LOCAL_MEDIA[title];
    if (exact) {
        return path.join(MEDIA_ROOT, exact);
    }

    // 2) Ð½Ð¾Ñ€Ð¼Ð°Ð»Ñ–Ð·Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð±Ñ–Ð³
    const normalizedTitle = normalizeTitle(title);
    const entry = Object.entries(LOCAL_MEDIA).find(([key]) => normalizeTitle(key) === normalizedTitle);
    if (entry) {
        return path.join(MEDIA_ROOT, entry[1]);
    }

    return null;
}

module.exports = { getLocalMediaPath };

